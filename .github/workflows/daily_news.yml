name: Daily News Bot

on:
  schedule:
    - cron: '0 8,18 * * *'
  workflow_dispatch:

jobs:
  run_bot:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # --- DEBUG STEP: THIS WILL SHOW US THE TRUTH ---
      - name: Debug - List all files
        run: |
          echo "Current folder:"
          pwd
          echo "Files in root:"
          ls -la
          echo "Searching for requirements.txt..."
          find . -name "requirements.txt"

      - name: Install Dependencies
        # We explicitly 'cd' into the folder before running pip
        run: |
          cd news_reader
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install chromium

      - name: Create Secrets File
        # We explicitly 'cd' here too
        run: |
          cd news_reader
          mkdir -p .streamlit
          echo '[secrets]' > .streamlit/secrets.toml
          echo 'GEMINI_API_KEY = "${{ secrets.GEMINI_API_KEY }}"' >> .streamlit/secrets.toml
          echo 'OPEN_AI_KEY = "${{ secrets.OPENAI_API_KEY }}"' >> .streamlit/secrets.toml
          echo 'GMAIL_USER = "${{ secrets.GMAIL_USER }}"' >> .streamlit/secrets.toml
          echo 'GMAIL_APP_PASSWORD = "${{ secrets.GMAIL_APP_PASSWORD }}"' >> .streamlit/secrets.toml

      - name: Run News Scraper
        # We explicitly 'cd' here too
        run: |
          cd news_reader
          python main.py -s yes
